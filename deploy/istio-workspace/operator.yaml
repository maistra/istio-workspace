kind: Template
apiVersion: template.openshift.io/v1
parameters:
  - name: IKE_DOCKER_REGISTRY
    description: "Docker registry where deployed image is available"
    required: true
    value: docker.io
  - name: IKE_DOCKER_REPOSITORY
    description: "Repository in which the image can be found"
    required: true
    value: maistra
  - name: IKE_IMAGE_NAME
    description: "The name of the image with ike binary"
    required: true
    value: istio-workspace
  - name: IKE_IMAGE_TAG
    description: "The tag of the image to be used"
    required: true
    value: latest
  - name: TELEPRESENCE_VERSION
    description: "Underlying Telepresence version used to deploy its images when swapping deployments in the cluster"
    required: true
    value: "0.101"
objects:
  - kind: Deployment
    apiVersion: apps/v1
    metadata:
      name: istio-workspace
    spec:
      replicas: 1
      selector:
        matchLabels:
          name: istio-workspace
      template:
        metadata:
          labels:
            name: istio-workspace
        spec:
          serviceAccountName: istio-workspace
          containers:
            - name: istio-workspace
              image: ${IKE_DOCKER_REGISTRY}/${IKE_DOCKER_REPOSITORY}/${IKE_IMAGE_NAME}:${IKE_IMAGE_TAG}
              command:
                - ike
              args:
                - serve
              imagePullPolicy: Always
              env:
                - name: WATCH_NAMESPACE
                  value: ""
                - name: POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: OPERATOR_NAME
                  value: "istio-workspace"
                - name: TELEPRESENCE_VERSION
                  value: "${TELEPRESENCE_VERSION}"
